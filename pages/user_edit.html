<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì› ì •ë³´ ìˆ˜ì •</title>
    <link rel="stylesheet" href="src/css/main.css">
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>

<body>
    <header>
        <a href="../index.html">í™ˆìœ¼ë¡œ</a>
    </header>

    <main>
        <h1>íšŒì› ì •ë³´ ìˆ˜ì •</h1>
        <form id="user-edit-form">
            <label for="name">ì´ë¦„:</label>
            <input type="text" id="name" name="name" required><br><br>

            <label for="email">ì´ë©”ì¼:</label>
            <input type="email" id="email" name="email" required><br><br>

            <label for="address">ì£¼ì†Œ:</label>
            <input type="text" id="address" name="address" required>
            <button type="button" id="postcode-button">ìš°í¸ë²ˆí˜¸ ì°¾ê¸°</button>

            <h2>ë‚´ê°€ ë³´ìœ í•œ ìˆ </h2>
            <!-- ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€ -->
            <div class="search"><input type="text" placeholder="ê²€ìƒ‰ì–´" /><button class="search-btn">ğŸ”</button></div>
            <!-- í•´ì‹œíƒœê·¸ ì„ íƒ ê¸°ëŠ¥ ì¶”ê°€ -->
            <div class="search-liquor">
                <div class="skill-tags">
                    <label><input type="checkbox" name="liquor[]" value="#ë³´ìœ ìˆ ">#ë³´ìœ ìˆ </label>
                    <label class="selected"><input type="checkbox" name="liquor[]" value="#ë³´ìœ ìˆ " checked>#ë³´ìœ ìˆ </label>
                    <!-- í•„ìš”í•œ í•´ì‹œíƒœê·¸ ì¶”ê°€ -->
                </div>
            </div>

            <h2>ì¢‹ì•„í•˜ëŠ” ìˆ </h2>
            <!-- ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€ -->
            <div class="search"><input type="text" placeholder="ê²€ìƒ‰ì–´" /><button class="search-btn">ğŸ”</button></div>
            <!-- í•´ì‹œíƒœê·¸ ì„ íƒ ê¸°ëŠ¥ ì¶”ê°€ -->
            <div class="search-liquor">
                <div class="skill-tags">
                    <label><input type="checkbox" name="liquor[]" value="#ì¢‹ì•„í•˜ëŠ”ìˆ ">#ì¢‹ì•„í•˜ëŠ”ìˆ </label>
                    <label><input type="checkbox" name="liquor[]" value="#ì¢‹ì•„í•˜ëŠ”ìˆ ">#ì¢‹ì•„í•˜ëŠ”ìˆ </label>
                    <!-- ì¶”ê°€ í•´ì‹œíƒœê·¸ -->
                </div>
            </div>

            <h2>ì‹«ì–´í•˜ëŠ” ìˆ </h2>
            <!-- ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€ -->
            <div class="search"><input type="text" placeholder="ê²€ìƒ‰ì–´" /><button class="search-btn">ğŸ”</button></div>
            <!-- í•´ì‹œíƒœê·¸ ì„ íƒ ê¸°ëŠ¥ ì¶”ê°€ -->
            <div class="search-liquor">
                <div class="skill-tags">
                    <label><input type="checkbox" name="liquor[]" value="#ì‹«ì–´í•˜ëŠ” ìˆ ">#ì‹«ì–´í•˜ëŠ” ìˆ </label>
                    <label><input type="checkbox" name="liquor]" value="#ì‹«ì–´í•˜ëŠ” ìˆ ">#ì‹«ì–´í•˜ëŠ” ìˆ </label>
                    <!-- ì¶”ê°€ í•´ì‹œíƒœê·¸ -->
                </div>
            </div>

            <button type="submit">ìˆ˜ì •í•˜ê¸°</button>
        </form>
        <p id="message"></p>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            const token = localStorage.getItem('access_token');
            const decodedToken = jwt_decode(token);
            const id = decodedToken.user_id;

            try {
                const response = await fetch(`http://localhost:8000/api/v1/accounts/${id}/`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                if (response.ok) {
                    const userData = await response.json();

                    document.getElementById('name').value = userData.name;
                    document.getElementById('email').value = userData.email;
                    document.getElementById('address').value = userData.address;
                } else {
                    throw new Error('íšŒì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
            }

            const form = document.getElementById('user-edit-form');
            form.addEventListener('submit', async function (e) {
                e.preventDefault();

                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const address = document.getElementById('address').value;

                try {
                    const response = await fetch(`http://localhost:8000/api/v1/accounts/${id}/`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: name,
                            email: email,
                            address: address
                        })
                    });

                    const result = await response.json();

                    if (response.ok) {
                        document.getElementById('message').textContent = 'íšŒì› ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    } else {
                        document.getElementById('message').textContent = result.message || 'ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                    }
                } catch (error) {
                    console.error('Error updating user data:', error);
                }
            });
            document.getElementById('postcode-button').addEventListener('click', function () {
                new daum.Postcode({
                    oncomplete: function (data) {
                        // ì„ íƒí•œ ì£¼ì†Œ ì •ë³´ë¥¼ ì£¼ì†Œ ì…ë ¥ í•„ë“œì— ì„¤ì •
                        document.getElementById('address').value = data.address;
                    }
                }).open();
            });
        });

    // í•´ì‹œíƒœê·¸ ì„ íƒ ê¸°ëŠ¥
    document.querySelectorAll('.skill-tags input[type="checkbox"]').forEach(function(checkbox) {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    this.parentElement.classList.add('selected');
                } else {
                    this.parentElement.classList.remove('selected');
                }
            });
        });
    </script>
</body>

</html>